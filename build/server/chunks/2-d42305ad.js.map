{"version":3,"file":"2-d42305ad.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_page.server.js","../../../.svelte-kit/adapter-node/nodes/2.js"],"sourcesContent":["import { a as activeIncident, m as mapper } from \"../../chunks/incident2.js\";\nimport fs from \"fs-extra\";\nimport { b as GetMinuteStartNowTimestampUTC, c as GetDayStartTimestampUTC } from \"../../chunks/tool.js\";\nimport { S as StatusObj } from \"../../chunks/helpers.js\";\nimport { p as public_env } from \"../../chunks/shared-server.js\";\nfunction parseUptime(up, all) {\n  if (all === 0)\n    return String(\"-\");\n  if (up == 0)\n    return String(\"0\");\n  if (up == all) {\n    return String((up / all * parseFloat(100)).toFixed(0));\n  }\n  return String((up / all * parseFloat(100)).toFixed(4));\n}\nfunction parsePercentage(n) {\n  if (isNaN(n))\n    return \"-\";\n  if (n == 0) {\n    return \"0\";\n  }\n  if (n == 100) {\n    return \"100\";\n  }\n  return n.toFixed(4);\n}\nconst secondsInDay = 24 * 60 * 60;\nfunction getDayData(day0, startTime, endTime) {\n  let dayData = {\n    UP: 0,\n    DEGRADED: 0,\n    DOWN: 0,\n    timestamp: startTime,\n    cssClass: StatusObj.NO_DATA,\n    message: \"No Data\"\n  };\n  for (let i = startTime; i <= endTime; i += 60) {\n    if (day0[i] === void 0) {\n      continue;\n    }\n    if (day0[i].status == \"UP\") {\n      dayData.UP++;\n    } else if (day0[i].status == \"DEGRADED\") {\n      dayData.DEGRADED++;\n    } else if (day0[i].status == \"DOWN\") {\n      dayData.DOWN++;\n    }\n  }\n  dayData.uptimePercentage = parseUptime(dayData.UP + dayData.DEGRADED, dayData.UP + dayData.DEGRADED + dayData.DOWN);\n  let cssClass = StatusObj.UP;\n  let message = \"Status OK\";\n  if (dayData.DEGRADED > 0) {\n    cssClass = StatusObj.DEGRADED;\n    message = \"Degraded for \" + dayData.DEGRADED + \" minutes\";\n  }\n  if (dayData.DOWN > 0) {\n    cssClass = StatusObj.DOWN;\n    message = \"Down for \" + dayData.DOWN + \" minutes\";\n  }\n  if (dayData.DEGRADED + dayData.DOWN + dayData.UP > 0) {\n    dayData.message = message;\n    dayData.cssClass = cssClass;\n  }\n  return dayData;\n}\nconst FetchData = async function(monitor, midnight, midnight90DaysAgo, tzOffset) {\n  let _0Day = {};\n  let _90Day = {};\n  let uptime0Day = \"0\";\n  let dailyUps = 0;\n  let dailyDown = 0;\n  let percentage90DaysBuildUp = [];\n  let dailyDegraded = 0;\n  const now = GetMinuteStartNowTimestampUTC() - tzOffset * 60;\n  midnight = GetDayStartTimestampUTC(now);\n  midnight90DaysAgo = midnight - 90 * 24 * 60 * 60;\n  const midnightTomorrow = midnight + secondsInDay;\n  for (let i = midnight; i <= now; i += 60) {\n    _0Day[i] = {\n      timestamp: i + tzOffset * 60,\n      status: \"NO_DATA\",\n      cssClass: StatusObj.NO_DATA,\n      index: (i - midnight) / 60\n    };\n  }\n  let day0UTC = JSON.parse(fs.readFileSync(monitor.path0Day, \"utf8\"));\n  let day0 = {};\n  for (const timestampUTC in day0UTC) {\n    const element = day0UTC[timestampUTC];\n    element.timestamp = parseInt(timestampUTC) - tzOffset * 60;\n    day0[parseInt(timestampUTC) - tzOffset * 60] = element;\n  }\n  for (const timestamp in day0) {\n    const element = day0[timestamp];\n    let status = element.status;\n    if (_0Day[timestamp] !== void 0) {\n      _0Day[timestamp].status = status;\n      _0Day[timestamp].cssClass = StatusObj[status];\n      dailyUps = status == \"UP\" ? dailyUps + 1 : dailyUps;\n      dailyDown = status == \"DOWN\" ? dailyDown + 1 : dailyDown;\n      dailyDegraded = status == \"DEGRADED\" ? dailyDegraded + 1 : dailyDegraded;\n    }\n  }\n  for (let i = midnight90DaysAgo; i < midnightTomorrow; i += secondsInDay) {\n    _90Day[i] = getDayData(day0, i, i + secondsInDay - 1);\n  }\n  for (const key in _90Day) {\n    const element = _90Day[key];\n    if (element.message == \"No Data\")\n      continue;\n    percentage90DaysBuildUp.push(parseFloat(element.uptimePercentage));\n  }\n  uptime0Day = parseUptime(dailyUps + dailyDegraded, dailyUps + dailyDown + dailyDegraded);\n  return {\n    _0Day,\n    _90Day,\n    uptime0Day,\n    uptime90Day: parsePercentage(percentage90DaysBuildUp.reduce((a, b) => a + b, 0) / percentage90DaysBuildUp.length),\n    dailyUps,\n    dailyDown,\n    dailyDegraded\n  };\n};\nasync function load({ params, route, url, parent }) {\n  let monitors = JSON.parse(fs.readFileSync(public_env.PUBLIC_KENER_FOLDER + \"/monitors.json\", \"utf8\"));\n  const parentData = await parent();\n  const siteData = parentData.site;\n  const github = siteData.github;\n  for (let i = 0; i < monitors.length; i++) {\n    const gitHubActiveIssues = await activeIncident(monitors[i].tag, github);\n    let data = await FetchData(monitors[i], parentData.startTodayAtTs, parentData.start90DayAtTs, parentData.tzOffset);\n    monitors[i].pageData = data;\n    monitors[i].activeIncidents = await Promise.all(gitHubActiveIssues.map(mapper, { github }));\n  }\n  return {\n    monitors\n  };\n}\nexport {\n  load\n};\n","import * as server from '../entries/pages/_page.server.js';\n\nexport const index = 2;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/2.0f128cac.js\",\"_app/immutable/chunks/scheduler.ea4d12df.js\",\"_app/immutable/chunks/index.12c4b772.js\",\"_app/immutable/chunks/globals.7f7f1b26.js\",\"_app/immutable/chunks/incident.1bd69fe5.js\",\"_app/immutable/chunks/index.06f948c6.js\",\"_app/immutable/chunks/index.7ea6c3d8.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}