{"version":3,"file":"_server-0c1b6d82.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/today/_server.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index.js\";\nimport fs from \"fs-extra\";\nimport moment from \"moment-timezone\";\nlet statusObj = {\n  UP: \"api-up\",\n  DEGRADED: \"api-degraded\",\n  DOWN: \"api-down\",\n  NO_DATA: \"api-nodata\"\n};\nfunction parseUptime(up, all) {\n  if (up == all) {\n    return String((up / all * parseFloat(100)).toFixed(0));\n  }\n  return String((up / all * parseFloat(100)).toFixed(4));\n}\nfunction parsePercentage(n) {\n  if (n == 0) {\n    return \"0\";\n  }\n  if (n == 100) {\n    return \"100\";\n  }\n  return n.toFixed(4);\n}\nasync function POST({ request }) {\n  const payload = await request.json();\n  const tz = payload.tz;\n  let _0Day = {};\n  let _90Day = {};\n  let uptime0Day = \"0\";\n  let dailyUps = 0;\n  let dailyDown = 0;\n  let percentage90DaysBuildUp = [];\n  let latency90DaysBuildUp = [];\n  let dailyDegraded = 0;\n  let dailyLatencyBuildUp = [];\n  const now = moment.tz(tz);\n  let minuteFromMidnightTillNow = now.diff(now.clone().startOf(\"day\"), \"minutes\");\n  for (let i = 0; i <= minuteFromMidnightTillNow; i++) {\n    let eachMin = moment.tz(tz).startOf(\"day\").add(i, \"minutes\").format(\"YYYY-MM-DD HH:mm:00\");\n    _0Day[eachMin] = {\n      timestamp: eachMin,\n      status: \"NO_DATA\",\n      cssClass: statusObj.NO_DATA,\n      latency: \"NA\",\n      index: i\n    };\n  }\n  let day0 = JSON.parse(fs.readFileSync(payload.day0, \"utf8\"));\n  for (let i = 0; i < day0.length; i++) {\n    let min = moment.tz(day0[i].timestamp, tz).format(\"YYYY-MM-DD HH:mm:00\");\n    let day = moment.tz(day0[i].timestamp, tz).format(\"YYYY-MM-DD\");\n    let status = day0[i].status;\n    let latency = day0[i].latency;\n    if (_90Day[day] === void 0) {\n      _90Day[day] = {\n        timestamp: day,\n        UP: status == \"UP\" ? 1 : 0,\n        DEGRADED: status == \"DEGRADED\" ? 1 : 0,\n        DOWN: status == \"DOWN\" ? 1 : 0,\n        latency,\n        avgLatency: latency\n      };\n    } else {\n      let d = _90Day[day];\n      _90Day[day] = {\n        timestamp: day,\n        UP: status == \"UP\" ? d.UP + 1 : d.UP,\n        DEGRADED: status == \"DEGRADED\" ? d.DEGRADED + 1 : d.DEGRADED,\n        DOWN: status == \"DOWN\" ? d.DOWN + 1 : d.DOWN,\n        latency: d.latency + latency,\n        avgLatency: ((d.latency + latency) / (d.UP + d.DEGRADED + d.DOWN + 1)).toFixed(0)\n      };\n    }\n    _90Day[day].uptimePercentage = parseUptime(_90Day[day].UP + _90Day[day].DEGRADED, _90Day[day].UP + _90Day[day].DEGRADED + _90Day[day].DOWN);\n    let cssClass = statusObj.UP;\n    let message = \"0 Issues\";\n    if (_90Day[day].DEGRADED > 0) {\n      cssClass = statusObj.DEGRADED;\n      message = \"Degraded for \" + _90Day[day].DEGRADED + \" minutes\";\n    }\n    if (_90Day[day].DOWN > 0) {\n      cssClass = statusObj.DOWN;\n      message = \"Down for \" + _90Day[day].DOWN + \" minutes\";\n    }\n    _90Day[day].cssClass = cssClass;\n    _90Day[day].message = message;\n    _90Day = Object.keys(_90Day).sort().reduce((obj, key) => {\n      obj[key] = _90Day[key];\n      return obj;\n    }, {});\n    if (_0Day[min] !== void 0) {\n      _0Day[min].status = status;\n      _0Day[min].cssClass = statusObj[status];\n      _0Day[min].latency = latency;\n      dailyUps = status == \"UP\" ? dailyUps + 1 : dailyUps;\n      dailyDown = status == \"DOWN\" ? dailyDown + 1 : dailyDown;\n      dailyDegraded = status == \"DEGRADED\" ? dailyDegraded + 1 : dailyDegraded;\n      dailyLatencyBuildUp.push(latency);\n    }\n  }\n  for (const key in _90Day) {\n    if (Object.hasOwnProperty.call(_90Day, key)) {\n      const element = _90Day[key];\n      percentage90DaysBuildUp.push(parseFloat(element.uptimePercentage));\n      latency90DaysBuildUp.push(parseFloat(element.avgLatency));\n    }\n  }\n  uptime0Day = parseUptime(dailyUps + dailyDegraded, dailyUps + dailyDown + dailyDegraded);\n  return json({\n    _0Day,\n    _90Day,\n    uptime0Day,\n    uptime90Day: parsePercentage(percentage90DaysBuildUp.reduce((a, b) => a + b, 0) / percentage90DaysBuildUp.length),\n    avgLatency90Day: (latency90DaysBuildUp.reduce((a, b) => a + b, 0) / latency90DaysBuildUp.length).toFixed(0),\n    avgLatency0Day: (dailyLatencyBuildUp.reduce((a, b) => a + b, 0) / dailyLatencyBuildUp.length).toFixed(0),\n    dailyUps,\n    dailyDown,\n    dailyDegraded\n  });\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}