{"version":3,"file":"2-595fef0e.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_page.server.js","../../../.svelte-kit/adapter-node/nodes/2.js"],"sourcesContent":["import { a as activeIncident, m as mapper } from \"../../chunks/incident2.js\";\nimport fs from \"fs-extra\";\nimport { a as GetMinuteStartNowTimestampUTC } from \"../../chunks/tool.js\";\nimport { S as StatusObj } from \"../../chunks/helpers.js\";\nimport { p as public_env } from \"../../chunks/shared-server.js\";\nfunction parseUptime(up, all) {\n  if (all === 0)\n    return String(\"-\");\n  if (up == 0)\n    return String(\"0\");\n  if (up == all) {\n    return String((up / all * parseFloat(100)).toFixed(0));\n  }\n  return String((up / all * parseFloat(100)).toFixed(4));\n}\nfunction parsePercentage(n) {\n  if (isNaN(n))\n    return \"-\";\n  if (n == 0) {\n    return \"0\";\n  }\n  if (n == 100) {\n    return \"100\";\n  }\n  return n.toFixed(4);\n}\nconst secondsInDay = 24 * 60 * 60;\nconst FetchData = async function(monitor, startTodayAtTs, start90DayAtTs, tzOffset) {\n  let _0Day = {};\n  let _90Day = {};\n  let uptime0Day = \"0\";\n  let dailyUps = 0;\n  let dailyDown = 0;\n  let percentage90DaysBuildUp = [];\n  let dailyDegraded = 0;\n  const now = GetMinuteStartNowTimestampUTC() - tzOffset * 60;\n  const midnight = startTodayAtTs;\n  const midnightTomorrow = midnight + secondsInDay;\n  const midnight90DaysAgo = start90DayAtTs;\n  for (let i = midnight; i <= now; i += 60) {\n    let eachMin = i;\n    _0Day[eachMin] = {\n      timestamp: eachMin,\n      status: \"NO_DATA\",\n      cssClass: StatusObj.NO_DATA,\n      index: i\n    };\n  }\n  for (let i = midnight90DaysAgo; i < midnightTomorrow; i += secondsInDay) {\n    let eachDay = i;\n    _90Day[eachDay] = {\n      timestamp: eachDay,\n      UP: 0,\n      DEGRADED: 0,\n      DOWN: 0,\n      uptimePercentage: 0,\n      cssClass: StatusObj.NO_DATA,\n      message: \"No Data\"\n    };\n  }\n  let day0 = JSON.parse(fs.readFileSync(monitor.path0Day, \"utf8\"));\n  let _90DayFileData = JSON.parse(fs.readFileSync(monitor.path90Day, \"utf8\"));\n  for (const timestamp in _90DayFileData) {\n    _90DayFileData[Number(timestamp) + tzOffset * 60] = _90DayFileData[timestamp];\n    delete _90DayFileData[timestamp];\n  }\n  for (const timestamp in _90DayFileData) {\n    let cssClass = StatusObj.UP;\n    let message = \"Status OK\";\n    const element = _90DayFileData[timestamp];\n    if (element === void 0)\n      continue;\n    if (_90Day[timestamp] === void 0)\n      continue;\n    _90Day[timestamp].UP = element.UP;\n    _90Day[timestamp].DEGRADED = element.DEGRADED;\n    _90Day[timestamp].DOWN = element.DOWN;\n    _90Day[timestamp].uptimePercentage = parseUptime(element.UP + element.DEGRADED, element.UP + element.DEGRADED + element.DOWN);\n    if (element.DEGRADED > 0) {\n      cssClass = StatusObj.DEGRADED;\n      message = \"Degraded for \" + element.DEGRADED + \" minutes\";\n    }\n    if (element.DOWN > 0) {\n      cssClass = StatusObj.DOWN;\n      message = \"Down for \" + element.DOWN + \" minutes\";\n    }\n    _90Day[timestamp].cssClass = cssClass;\n    _90Day[timestamp].message = message;\n  }\n  for (const timestamp in day0) {\n    const element = day0[timestamp];\n    let status = element.status;\n    if (_0Day[timestamp] !== void 0) {\n      _0Day[timestamp].status = status;\n      _0Day[timestamp].cssClass = StatusObj[status];\n      dailyUps = status == \"UP\" ? dailyUps + 1 : dailyUps;\n      dailyDown = status == \"DOWN\" ? dailyDown + 1 : dailyDown;\n      dailyDegraded = status == \"DEGRADED\" ? dailyDegraded + 1 : dailyDegraded;\n    }\n  }\n  for (const key in _90Day) {\n    const element = _90Day[key];\n    if (element.message == \"No Data\")\n      continue;\n    percentage90DaysBuildUp.push(parseFloat(element.uptimePercentage));\n  }\n  uptime0Day = parseUptime(dailyUps + dailyDegraded, dailyUps + dailyDown + dailyDegraded);\n  return {\n    _0Day,\n    _90Day,\n    uptime0Day,\n    uptime90Day: parsePercentage(percentage90DaysBuildUp.reduce((a, b) => a + b, 0) / percentage90DaysBuildUp.length),\n    dailyUps,\n    dailyDown,\n    dailyDegraded\n  };\n};\nasync function load({ params, route, url, parent }) {\n  let monitors = JSON.parse(fs.readFileSync(public_env.PUBLIC_KENER_FOLDER + \"/monitors.json\", \"utf8\"));\n  const parentData = await parent();\n  const siteData = parentData.site;\n  const github = siteData.github;\n  for (let i = 0; i < monitors.length; i++) {\n    const gitHubActiveIssues = await activeIncident(monitors[i].tag, github);\n    let data = await FetchData(monitors[0], parentData.startTodayAtTs, parentData.start90DayAtTs, parentData.tzOffset);\n    monitors[i].pageData = data;\n    monitors[i].activeIncidents = await Promise.all(gitHubActiveIssues.map(mapper, { github }));\n  }\n  return {\n    monitors\n  };\n}\nexport {\n  load\n};\n","import * as server from '../entries/pages/_page.server.js';\n\nexport const index = 2;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/2.a095b352.js\",\"_app/immutable/chunks/scheduler.ea4d12df.js\",\"_app/immutable/chunks/index.12c4b772.js\",\"_app/immutable/chunks/globals.7f7f1b26.js\",\"_app/immutable/chunks/incident.1bd69fe5.js\",\"_app/immutable/chunks/index.06f948c6.js\",\"_app/immutable/chunks/index.7ea6c3d8.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}